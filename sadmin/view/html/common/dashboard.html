<?php echo $header; ?>
<?php echo $nav; ?>
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1><?php echo $heading_title; ?></h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <?php for($i = 0; $i < count($breadcrumbs); $i++) : ?>
                        <?php if($i != (count($breadcrumbs) - 1)) : ?>
                        <?php if($i == 0) : ?>
                        <li class="breadcrumb-item">
                            <i class="nav-icon fa fa-home"></i>
                            <a href="<?php echo $breadcrumbs[$i]['href']; ?>">
                                <?php echo $breadcrumbs[$i]['text']; ?>
                            </a>
                        </li>
                        <?php else : ?>
                        <li class="breadcrumb-item">
                            <a href="<?php echo $breadcrumbs[$i]['href']; ?>">
                                <?php echo $breadcrumbs[$i]['text']; ?>
                            </a>
                        </li>
                        <?php endif; ?>
                        <?php else : ?>
                        <li class="breadcrumb-item active"><?php echo $breadcrumbs[$i]['text']; ?></li>
                        <?php endif; ?>
                        <?php endfor; ?>
                    </ol>
                </div>
            </div>
        </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
        <!-- Main row -->
        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header no-border">
                        <div class="d-flex justify-content-between">
                            <h3 class="card-title">Online Store Visitors</h3>
                            <a href="javascript:void(0);">View Report</a>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="d-flex">
                            <p class="d-flex flex-column">
                                <span class="text-bold text-lg"><?php echo $total_visitors; ?></span>
                                <span>Visitors Over Time</span>
                            </p>
                            <p class="ml-auto d-flex flex-column text-right">
                                <?php if($percentage > 0) : ?>
                                <span class="text-success">
                                    <i class="fa fa-arrow-up"></i> <?php echo number_format(abs($percentage), 2); ?>%
                                </span>
                                <?php elseif($percentage < 0) : ?>
                                <span class="text-danger">
                                    <i class="fa fa-arrow-down"></i> <?php echo number_format(abs($percentage), 2); ?>%
                                </span>
                                <?php else : ?>
                                <span class="text-info">
                                    <i class="far fa-dot-circle"></i> <?php echo number_format(abs($percentage), 2); ?>%
                                </span>
                                <?php endif; ?>
                                <span class="text-muted">Since last week</span>
                            </p>
                        </div>
                        <!-- /.d-flex -->

                        <div class="position-relative mb-4">
                            <div class="chartjs-size-monitor"
                                style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;">
                                <div class="chartjs-size-monitor-expand"
                                    style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                                    <div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div>
                                </div>
                                <div class="chartjs-size-monitor-shrink"
                                    style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                                    <div style="position:absolute;width:200%;height:200%;left:0; top:0"></div>
                                </div>
                            </div>
                            <canvas id="visitors-chart" height="200" width="764" class="chartjs-render-monitor"
                                style="display: block; width: 764px; height: 200px;"></canvas>
                        </div>

                        <div class="d-flex flex-row justify-content-end">
                            <span class="mr-2">
                                <i class="fa fa-square text-primary"></i> This Week
                            </span>

                            <span>
                                <i class="fa fa-square text-gray"></i> Last Week
                            </span>
                        </div>
                    </div>
                </div>
                <!-- /.card -->
            </div>
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header no-border">
                        <h3 class="card-title">Overview</h3>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center border-bottom mb-3">
                            <p class="text-success text-xl">
                                <i class="<?php echo $website_icon; ?>"></i>
                            </p>
                            <p class="d-flex flex-column text-right">
                                <span class="font-weight-bold">
                                    <?php echo $website; ?>
                                </span>
                                <span class="text-muted"> <?php echo $text_website; ?></span>
                            </p>
                        </div>
                        <!-- /.d-flex -->
                        <div class="d-flex justify-content-between align-items-center border-bottom mb-3">
                            <p class="text-info text-xl">
                                <i class="<?php echo $ecommerce_icon; ?>"></i>
                            </p>
                            <p class="d-flex flex-column text-right">
                                <span class="font-weight-bold">
                                    <?php echo $ecommerce; ?>
                                </span>
                                <span class="text-muted"><?php echo $text_ecommerce; ?></span>
                            </p>
                        </div>
                        <!-- /.d-flex -->
                        <div class="d-flex justify-content-between align-items-center border-bottom mb-3">
                            <p class="text-warning text-xl">
                                <i class="<?php echo $software_icon; ?>"></i>
                            </p>
                            <p class="d-flex flex-column text-right">
                                <span class="font-weight-bold">
                                    <?php echo $software; ?>
                                </span>
                                <span class="text-muted"><?php echo $text_software; ?></span>
                            </p>
                        </div>
                        <!-- /.d-flex -->
                        <div class="d-flex justify-content-between align-items-center mb-0">
                            <p class="text-danger text-xl">
                                <i class="<?php echo $client_icon; ?>"></i>
                            </p>
                            <p class="d-flex flex-column text-right">
                                <span class="font-weight-bold">
                                    <?php echo $client; ?>
                                </span>
                                <span class="text-muted"><?php echo $text_client; ?></span>
                            </p>
                        </div>
                        <!-- /.d-flex -->
                    </div>
                </div>
                <!-- /.card -->
            </div>

        </div>
        <div class="row">
            <div class="col-lg-6">

                <div class="card">
                    <div class="card-header no-border">
                        <h3 class="card-title"> <?php echo $text_title; ?></h3>
                    </div>
                    <div class="card-body p-0">
                        <table class="table table-striped table-valign-middle">
                            <thead>
                                <tr>
                                    <th>
                                        <?php echo $column_name; ?>
                                    </th>
                                    <th>
                                        <?php echo $column_email; ?>
                                    </th>
                                    <th>
                                        <?php echo $column_date; ?>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php if($enquiries) : ?>
                                <?php foreach($enquiries as $enquiry) : ?>
                                <tr>
                                    <td class="text-left">
                                        <?php echo $enquiry['name']; ?>
                                    </td>
                                    <td class="text-left">
                                        <?php echo $enquiry['email']; ?>
                                    </td>
                                    <td class="text-left">
                                        <?php echo $enquiry['date_added']; ?>
                                    </td>
                                </tr>
                                <?php endforeach; ?>
                                <?php else : ?>
                                <tr>
                                    <td class="text-center" colspan="5">
                                        <?php echo $text_no_results; ?>
                                    </td>
                                </tr>
                                <?php endif; ?>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- /.card -->
            </div>
            <!-- /.col-md-6 -->
            <div class="col-lg-6">

                <!-- /.card -->
                <div class="card">
                    <div class="card-header no-border">
                        <h3 class="card-title"> <?php echo $text_service; ?></h3>
                    </div>
                    <div class="card-body p-0">
                        <table class="table table-striped table-valign-middle">
                            <thead>
                                <tr>
                                    <th>
                                        <?php echo $column_name; ?>
                                    </th>
                                    <th>
                                        <?php echo $column_sort_order; ?>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach($services as $service) : ?>
                                <tr>

                                    <td class="text-left">
                                        <?php echo $service['name']; ?>
                                    </td>
                                    <td class="text-left">
                                        <?php echo $service['sort_order']; ?>
                                    </td>
                                </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- /.col-md-6 -->
        </div>
        <!-- /.row (main row) -->

    </section>
    <!-- /.content -->
</div>
<!-- /.content-wrapper -->
<?php echo $footer; ?>
<script type="text/javascript">
    var now = new Date(),
        start = now.getDate() - now.getDay(),
        end = start + 6,
        // current = new Date(now.setDate(start)),
        // last = new Date(now.setDate(end)),
        current = new Date(now.getFullYear(), now.getMonth(), start),
        last = new Date(now.getFullYear(), now.getMonth(), end),
        range = [];

    while (current <= last) {
        range.push(new Date(current).getDate());
        current.setDate(current.getDate() + 1);
    }

    var dateRange = [];
    var suffix = '';

    for (var i = 0; i < range.length; i++) {
        switch (range[i]) {
            case 1:
            case 21:
            case 31:
                suffix = 'st';
                break;
            case 2:
            case 22:
                suffix = 'nd';
                break;
            case 3:
            case 23:
                suffix = 'rd';
                break;
            default:
                suffix = 'th';
        }

        dateRange.push(range[i] + suffix);
    }

    var current_week = JSON.parse('<?php echo $current_week; ?>');
    var last_week = JSON.parse('<?php echo $last_week; ?>');

    var current_week_total = Math.max.apply(Math, current_week);
    var last_week_total = Math.max.apply(Math, last_week);

    var ticksStyle = {
        fontColor: '#495057',
        fontStyle: 'bold'
    }

    var mode = 'index'
    var intersect = true

    var $visitorsChart = $('#visitors-chart')
    var visitorsChart = new Chart($visitorsChart, {
        data: {
            //labels: ['18th', '20th', '22nd', '24th', '26th', '28th', '30th'],
            labels: dateRange,
            datasets: [{
                    type: 'line',
                    //data: [100, 120, 170, 167, 180, 177, 160],
                    data: current_week,
                    backgroundColor: 'transparent',
                    borderColor: '#007bff',
                    pointBorderColor: '#007bff',
                    pointBackgroundColor: '#007bff',
                    fill: false
                    // pointHoverBackgroundColor: '#007bff',
                    // pointHoverBorderColor : '#007bff'
                },
                {
                    type: 'line',
                    //data: [60, 80, 70, 67, 80, 77, 100],
                    data: last_week,
                    backgroundColor: 'tansparent',
                    borderColor: '#ced4da',
                    pointBorderColor: '#ced4da',
                    pointBackgroundColor: '#ced4da',
                    fill: false
                    // pointHoverBackgroundColor: '#ced4da',
                    // pointHoverBorderColor : '#ced4da'
                }
            ]
        },
        options: {
            maintainAspectRatio: false,
            tooltips: {
                mode: mode,
                intersect: intersect
            },
            hover: {
                mode: mode,
                intersect: intersect
            },
            legend: {
                display: false
            },
            scales: {
                yAxes: [{
                    // display: false,
                    gridLines: {
                        display: true,
                        lineWidth: '4px',
                        color: 'rgba(0, 0, 0, .2)',
                        zeroLineColor: 'transparent'
                    },
                    ticks: $.extend({
                        beginAtZero: true,
                        suggestedMax: (current_week_total < last_week_total) ? last_week_total :
                            current_week_total
                    }, ticksStyle)
                }],
                xAxes: [{
                    display: true,
                    gridLines: {
                        display: false
                    },
                    ticks: ticksStyle
                }]
            }
        }
    })
</script>